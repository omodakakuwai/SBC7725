10 ?="INPUT SIZE(3-1000)"
11 S=?
12 #=S<3*14
13 #=S<1001*20
14 ?="WRONG NUMBER!"
15 #=10
20 ?="CALC PI START"
21 ?="STAGE(1/3): CALC ARCTAN(1/5)"
30 Z=0
40 :Z)=0
50 Z=Z+1
60 #=Z<(S*10)*40
70 K=0
80 :2*S)=1
90 :4*S-1)=1
100 :S)=5
110 :8*S)=2
120 :9*S)=4
130 Z=0
140 :Z)=:S+Z)
150 Z=Z+1
160 #=Z<S*140
201 ?="DIV(0)"
202 X=10*S
203 :X)=3
204 :X+1)=1
205 :X+2)=4
206 X=X+3
207 #=4000
208 X=X-3
209 Z=0
210 :3*S+Z)=0
211 Z=Z+1
212 #=Z<S*210
213 :4*S-1)=1
214 ?="MUL(1)"
215 :X)=0
216 :X+1)=1
217 :X+2)=7
218 X=X+3
219 #=3000
220 X=X-3
221 ?="MUL(2)"
222 :X)=1
223 :X+1)=7
224 :X+2)=0
225 X=X+3
226 #=3000
227 X=X-3
228 ?="ADD(1)"
229 :X)=2
230 :X+1)=8
231 :X+2)=2
232 X=X+3
233 #=1000
234 X=X-3
235 ?="MUL(3)"
236 :X)=2
237 :X+1)=0
238 :X+2)=7
239 X=X+3
240 #=3000
241 X=X-3
242 ?="DIV(1)"
243 :X)=3
244 :X+1)=7
245 :X+2)=6
246 X=X+3
247 #=4000
248 X=X-3
249 Z=0
250 :3*S+Z)=0
251 Z=Z+1
252 #=Z<S*250
253 :4*S-1)=1
254 :X)=4
255 :X+1)=6
256 :X+2)=4
257 X=X+3
258 #=(K=1)*263
259 ?="SUB(1)"
260 #=2000
261 K=1
262 #=266
263 ?="ADD(2)"
264 #=1000
265 K=0
266 X=X-3
267 ?="ERR:";
268 Z=0
269 T=7*S-1-Z
270 ?=:T)
271 ?=" ";
272 Z=Z+1
273 #=Z<S*269
274 ?=""
275 ?="ATN:";
276 Z=0
277 T=5*S-1-Z
278 ?=:T)
279 ?=" ";
280 Z=Z+1
281 #=Z<S*277
282 ?=""
300 :X)=6
310 X=X+1
320 #=5000
330 X=X-1
340 I=R
350 #=(I=0)*370
360 #=214
370 ?="STAGE(2/3): CALC ARCTAN(1/239)"
400 Z=0
410 :Z)=0
420 Z=Z+1
430 #=Z<(S*4)*410
440 K=0
450 :2*S)=1
460 :4*S-1)=1
470 :S)=39
480 :S+1)=2
490 Z=0
500 :Z)=:S+Z)
510 Z=Z+1
520 #=Z<S*500
601 ?="DIV(0)"
603 :X)=3
604 :X+1)=1
605 :X+2)=5
606 X=X+3
607 #=4000
608 X=X-3
609 Z=0
610 :3*S+Z)=0
611 Z=Z+1
612 #=Z<S*610
613 :4*S-1)=1
614 ?="MUL(1)"
615 :X)=0
616 :X+1)=1
617 :X+2)=7
618 X=X+3
619 #=3000
620 X=X-3
621 ?="MUL(2)"
622 :X)=1
623 :X+1)=7
624 :X+2)=0
625 X=X+3
626 #=3000
627 X=X-3
628 ?="ADD(1)"
629 :X)=2
630 :X+1)=8
631 :X+2)=2
632 X=X+3
633 #=1000
634 X=X-3
635 ?="MUL(3)"
636 :X)=2
637 :X+1)=0
638 :X+2)=7
639 X=X+3
640 #=3000
641 X=X-3
642 ?="DIV(1)"
643 :X)=3
644 :X+1)=7
645 :X+2)=6
646 X=X+3
647 #=4000
648 X=X-3
649 Z=0
650 :3*S+Z)=0
651 Z=Z+1
652 #=Z<S*650
653 :4*S-1)=1
654 :X)=5
655 :X+1)=6
656 :X+2)=5
657 X=X+3
658 #=(K=1)*663
659 ?="SUB(1)"
660 #=2000
661 K=1
662 #=666
663 ?="ADD(2)"
664 #=1000
665 K=0
666 X=X-3
667 ?="ERR:";
668 Z=0
669 T=7*S-1-Z
670 ?=:T)
671 ?=" ";
672 Z=Z+1
673 #=Z<S*669
674 ?=""
675 ?="ATN:";
676 Z=0
677 T=6*S-1-Z
678 ?=:T)
679 ?=" ";
680 Z=Z+1
681 #=Z<S*677
682 ?=""
700 :X)=6
701 X=X+1
702 #=5000
703 X=X-1
704 I=R
705 #=(I=0)*710
706 #=614
710 ?="STAGE(3/3): CALC PI=4*(4*ARCTAN(1/5)-ARCTAN(1/239))"
711 :X)=4
712 :X+1)=9
713 :X+2)=6
714 X=X+3
715 #=3000
716 X=X-3
717 :X)=6
718 :X+1)=5
719 :X+2)=6
720 X=X+3
721 #=2000
722 X=X-3
723 :X)=6
724 :X+1)=9
725 :X+2)=7
726 X=X+3
727 #=3000
728 X=X-3
800 Z=0
810 T=8*S-1-Z
820 ?=:T)
830 ?=" ";
840 Z=Z+1
850 #=Z<S*810
990 #=9999
1000 ) ADD
1010 :X)=!
1020 X=X+1
1060 Z=0
1070 T=:X-4)*S+Z
1080 U=:X-3)*S+Z
1090 V=:X-2)*S+Z
1100 :V)=:T)+:U)
1110 Z=Z+1
1120 #=Z<S*1070
1130 Z=0
1140 V=:X-2)*S+Z
1150 #=:V)>100*1170
1160 #=1250
1170 #=:V)<200*1200
1180 #=:V)<65437*1230
1190 #=1250
1200 :V)=:V)-100
1210 :V+1)=:V+1)+1
1220 #=1250
1230 :V)=:V)+100
1240 :V+1)=:V+1)-1
1250 Z=Z+1
1260 #=Z<S*1140
1270 :X)=:X-2)
1280 X=X+1
1290 #=5000
1300 X=X-1
1310 I=R
1320 #=(I=0)*1980
1330 Z=0
1331 V=:X-2)*S+Z
1340 #=(I=255)*1390
1350 #=:V)>65437*1360
1351 #=1420
1360 :V+1)=:V+1)-1
1370 :V)=:V)+100
1380 #=1420
1390 #=:V)>100*1420
1400 :V+1)=:V+1)+1
1410 :V)=:V)-100
1420 Z=Z+1
1430 #=Z<S*1331
1980 X=X-1
1990 #=:X)
2000 ) SUB
2010 :X)=!
2020 X=X+1
2060 :X)=:X-3)
2070 X=X+1
2080 #=7000
2090 X=X-1
2100 :X)=:X-4)
2120 :X+1)=:X-3)
2140 :X+2)=:X-2)
2150 X=X+3
2160 #=1000
2170 X=X-3
2180 :X)=:X-3)
2190 X=X+1
2200 #=7000
2210 X=X-1
2980 X=X-1
2990 #=:X)
3000 ) MUL
3010 :X)=!
3020 X=X+1
3030 T=:X-4)*S
3040 U=:X-3)*S
3050 V=:X-2)*S
3060 Z=0
3070 :V+Z)=0
3080 Z=Z+1
3090 #=Z<S*3070
3100 Y=0
3110 #=:U+Y)=0*3210
3120 Z=0
3130 :V+Y+Z)=:V+Y+Z)+(:T+Z)*:U+Y))
3140 #=:V+Y+Z)>100*3160
3150 #=3190
3160 Q=:V+Y+Z)/100
3170 :V+Y+Z)=:V+Y+Z)-(Q*100)
3180 :V+Y+Z+1)=:V+Y+Z+1)+Q
3190 Z=Z+1
3200 #=Z<S*3130
3210 Y=Y+1
3220 #=Y<S*3110
3980 X=X-1
3990 #=:X)
4000 ) DIV
4010 :X)=!
4020 X=X+1
4060 P=0
4070 Z=0
4071 D=:X-2)
4080 :D*S+Z)=0
4090 Z=Z+1
4100 #=Z<S*4080
4110 :X)=:X-4)
4120 X=X+1
4130 #=5000
4140 X=X-1
4150 G=R
4160 :X)=:X-3)
4170 X=X+1
4180 #=5000
4190 X=X-1
4200 H=R
4210 #=(G=0)*4980
4220 #=(H=0)*4980
4230 #=(G=255)*4250
4240 #=4290
4250 :X)=:X-4)
4260 X=X+1
4270 #=7000
4280 X=X-1
4290 #=(H=255)*4310
4300 #=4350
4310 :X)=:X-3)
4320 X=X+1
4330 #=7000
4340 X=X-1
4350 :X)=:X-4)
4370 :X+1)=:X-3)
4380 X=X+2
4390 #=6000
4400 X=X-2
4410 I=R
4411 T=:X-3)
4420 J=:(T+1)*S-1)/10
4430 #=(I=1)*4450
4440 #=4530
4450 #=(J=0)*4470
4460 #=4530
4470 P=P+1
4480 :X)=:X-3)
4490 X=X+1
4500 #=9000
4510 X=X-1
4520 #=4350
4530 #=(P>32768)*4850
4540 :X)=:X-4)
4560 :X+1)=:X-3)
4570 X=X+2
4580 #=6000
4590 X=X-2
4600 I=R
4610 #=(I=255)*4770
4620 :X)=:X-4)
4640 :X+1)=:X-3)
4660 :X+2)=:X-4)
4670 X=X+3
4680 #=2000
4690 X=X-3
4700 Z=P/2
4710 T=:X-2)*S+Z
4720 #=(%=0)*4750
4730 :T)=:T)+10
4740 #=4530
4750 :T)=:T)+1
4760 #=4530
4770 #=(P>32768)*4830
4780 #=(P=0)*4830
4790 :X)=:X-3)
4800 X=X+1
4810 #=8000
4820 X=X-1
4830 P=P-1
4831 ?=".";
4840 #=4530
4850 ?=""
4851 #=(G=255)*4870
4860 #=4910
4870 :X)=:X-4)
4880 X=X+1
4890 #=7000
4900 X=X-1
4910 #=(H=255)*4930
4920 #=4970
4930 :X)=:X-3)
4940 X=X+1
4950 #=7000
4960 X=X-1
4970 #=(G=H)*4980
4973 :X)=:X-2)
4974 X=X+1
4975 #=7000
4976 X=X-1
4980 X=X-1
4990 #=:X)
5000 ) CMP0
5010 :X)=!
5020 X=X+1
5040 Z=0
5041 D=:X-2)
5050 T=(D+1)*S-1-Z
5060 #=:T)>65437*5120
5070 #=:T)>1*5140
5080 Z=Z+1
5090 #=Z<S*5050
5100 R=0
5110 #=5980
5120 R=255
5130 #=5980
5140 R=1
5980 X=X-1
5990 #=:X)
6000 ) CMP
6010 :X)=!
6020 X=X+1
6030 D=:X-3)
6040 E=:X-2)
6050 Z=0
6060 T=(D+1)*S-1-Z
6070 U=(E+1)*S-1-Z
6080 #=:T)<:U)*6140
6090 #=:T)>(:U)+1)*6160
6100 Z=Z+1
6110 #=Z<S*6060
6120 R=0
6130 #=6980
6140 R=255
6150 #=6980
6160 R=1
6980 X=X-1
6990 #=:X)
7000 ) TURN
7010 :X)=!
7020 X=X+1
7030 D=:X-2)
7040 Z=0
7050 T=D*S+Z
7060 #=:T)>1*7080
7070 #=7090
7080 :T)=65536-:T)
7090 Z=Z+1
7100 #=Z<S*7050
7980 X=X-1
7990 #=:X)
8000 ) R_SHIFT
8010 :X)=!
8020 X=X+1
8030 D=:X-2)
8040 T=D*S
8050 :T)=:T)/10
8060 Z=1
8070 T=D*S+Z
8080 Q=:T)
8090 :T)=:T)/10
8091 U=:T)*10
8092 U=Q-U
8093 U=U*10
8100 :T-1)=:T-1)+U
8110 Z=Z+1
8120 #=Z<S*8070
8980 X=X-1
8990 #=:X)
9000 ) L_SHIFT
9010 :X)=!
9020 X=X+1
9030 D=:X-2)
9040 Z=0
9050 T=(D+1)*S-1-Z
9060 :T)=:T)*10
9070 Q=:T)/100
9080 :T)=:T)-(Q*100)
9090 #=(Q>32768)*9120
9100 #=(Q=0)*9120
9110 :T+1)=:T+1)+Q
9120 Z=Z+1
9130 #=Z<S*9050
9980 X=X-1
9990 #=:X)
